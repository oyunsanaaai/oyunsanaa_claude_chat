<!doctype html>
<html lang="mn">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>–û—é—É–Ω—Å–∞–Ω–∞–∞ ‚Äî –ß–∞—Ç</title>

<!-- –§–æ–Ω—Ç (—Ö–æ—ë—Ä—Ö–æ–Ω ‚Äî Inter 400/600, Montserrat 700) -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&family=Montserrat:wght@700&display=swap" rel="stylesheet">

<style>
:root{
  --brand:#800000; --bg:#fff; --text:#222; --muted:#8a8a8a; --line:#e9e9ee;
  --user:#f7f2f2; --bot:#fff; --shadow:0 10px 30px rgba(0,0,0,.12);
  --font-ui:"Inter", system-ui, -apple-system, "Segoe UI", Arial, sans-serif;
  --font-title:"Montserrat", var(--font-ui);
  --t-base:14px; --line-compact:1.25;
}

/* === FAB (2 ‚Äú–Ø—Ä–∏–ª—Ü—å—è‚Äù) === */
.oy-fab{position:fixed;z-index:9998;background:var(--brand);color:#fff;border:none;border-radius:999px;
  padding:10px 14px;box-shadow:var(--shadow);display:flex;gap:8px;align-items:center;font:600 14px var(--font-ui);cursor:pointer}
.oy-fab svg{width:18px;height:18px;fill:#fff}
.oy-fab-primary{bottom:20px;right:20px}
.oy-fab-secondary{bottom:68px;right:20px;background:#333}
@media (max-width:520px){.oy-fab-primary,.oy-fab-secondary{bottom:14px;right:14px}}

/* === Overlay + Modal === */
[hidden]{display:none!important}
.oy-overlay{position:fixed;inset:0;background:rgba(0,0,0,.35);z-index:9999}
.oy-modal{position:fixed;z-index:10000;right:16px;bottom:82px;width:100%;max-width:420px;height:80vh;max-height:720px;
  background:#fff;border-radius:20px;box-shadow:var(--shadow);display:flex;flex-direction:column;overflow:hidden}
@media (max-width:520px){.oy-modal{right:0;left:0;bottom:0;width:100%;height:100vh;border-radius:0}}

/* === Header === */
.oy-topbar-spacer{height:0}
.oy-header{position:sticky;top:0;height:52px;background:var(--brand);color:#fff;display:flex;align-items:center;z-index:2}
.oy-iconbtn{background:transparent;border:none;color:#fff;cursor:pointer;width:44px;height:44px;display:grid;place-items:center}
.oy-iconbtn svg{width:16px;height:16px;fill:#fff;stroke:#fff;stroke-width:1.5}
.oy-title{flex:1;text-align:center;font:600 var(--t-base)/1.2 var(--font-title);padding:0 6px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}

/* === Drawer/Menu === */
.oy-drawer{position:absolute;inset:0 auto 0 0;width:84%;max-width:320px;background:#fff;border-right:1px solid var(--line);
  transform:translateX(-102%);transition:transform .25s ease;display:flex;flex-direction:column;z-index:3}
.oy-drawer.open{transform:translateX(0)}
.oy-menu{flex:1;overflow:auto;padding:8px;-webkit-overflow-scrolling:touch}
.oy-card{border:1px solid var(--line);border-radius:12px;padding:10px;background:#fff;margin:6px 4px}
.kv{font:600 13px var(--font-ui);margin:4px 0}
.oy-item{padding:10px 12px;border-radius:12px;cursor:pointer;border:1px solid var(--line);
  background:#fff;margin:6px 4px;font:14px var(--font-ui);display:flex;justify-content:space-between;align-items:center}
.oy-section{margin:10px 6px}
.oy-section h4{margin:10px 6px 6px;font:700 13px var(--font-title)}
.hint{font:12px/1.3 var(--font-ui);color:#666;margin:6px 8px}

/* === Chat lists (pills) === */
.oy-pills{display:flex;flex-direction:column;gap:8px}
.oy-pill{--c:#eee;--tc:#111;background:var(--c);color:var(--tc);border-radius:16px;padding:12px 14px;border:1px solid rgba(0,0,0,.06);
  cursor:pointer;display:flex;justify-content:space-between;align-items:center;font:600 13px var(--font-ui);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.oy-pill .r{opacity:.7;font:12px/1.2 ui-monospace,monospace}

/* === Active chats === */
#activeList .item{display:flex;align-items:center;gap:8px;border:1px solid var(--line);border-radius:12px;padding:8px 10px;margin:6px 4px;background:#fff}
#activeList .dot{width:10px;height:10px;border-radius:999px;background:#bbb;flex:0 0 auto}
#activeList .name{flex:1;cursor:pointer;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;font:600 14px/1.25 var(--font-title);color:#222}
#activeList button{border:none;background:#eee;border-radius:8px;padding:2px 8px;cursor:pointer}

/* === Panel in drawer === */
.oy-panel{position:absolute;inset:0;background:#fff;border-left:1px solid var(--line);display:flex;flex-direction:column;z-index:4}
.oy-panel header{height:44px;display:flex;align-items:center;gap:10px;padding:0 8px;border-bottom:1px solid var(--line);background:#fafafa}
.oy-back{border:1px solid var(--line);background:#fff;border-radius:10px;padding:6px 10px;cursor:pointer}
.oy-panel-title{font:600 14px var(--font-ui)}
.oy-panel-body{padding:10px;overflow:auto}
.card{border:1px solid var(--line);border-radius:12px;padding:10px;margin:8px 0;background:#fff}
.muted{color:#777;font:12px/1.4 var(--font-ui)}

/* === Chat area === */
.oy-chat{position:relative;flex:1;background:#fafafa;overflow:auto}
.oy-stream{padding:12px 12px 100px;max-width:720px;margin:0 auto}
.oy-bubble{max-width:84%;padding:10px 12px;border-radius:16px;margin:6px 0;font:14px/1.45 var(--font-ui)}
.oy-bot{background:var(--bot);border:1px solid var(--line);border-top-left-radius:6px}
.oy-user{background:var(--user);border:1px solid var(--line);border-top-right-radius:6px;margin-left:auto}
.oy-meta{color:var(--muted);font:11px;margin:2px 0 0}

/* === Composer === */
.oy-composer{position:absolute;left:0;right:0;bottom:0;background:#fff;border-top:1px solid var(--line)}
.oy-row{display:grid;grid-template-columns:40px 1fr 44px;gap:8px;padding:8px;align-items:center}
.oy-file{position:relative;width:32px;height:32px;display:flex;align-items:center;justify-content:center;border:1px dashed var(--line);border-radius:12px;background:#fff;cursor:pointer}
.oy-file svg{width:18px;height:18px;color:var(--brand)}
.oy-textarea{min-height:42px;max-height:120px;resize:none;border:1px solid var(--line);border-radius:12px;padding:10px 12px;font:14px/1.35 var(--font-ui);outline:none;background:#fdfdfd}
.oy-send{height:40px;width:44px;border:none;background:var(--brand);color:#fff;border-radius:12px;display:grid;place-items:center;cursor:pointer}
.oy-send svg{width:18px;height:18px;fill:#fff}

/* A11y ‚Äî braille (4 —Ü—ç—Å –¥—ç—ç—Ä) */
.braille{position:absolute;left:-999em;top:auto;width:1px;height:1px;overflow:hidden}
body{margin:0;background:#fff;color:var(--text)}
</style>
</head>
<body>

<!-- 2 —É–ª–∞–∞–Ω ‚Äú–Ø—Ä–∏–ª—Ü—å—è‚Äù -->
<button id="oyOpen1" class="oy-fab oy-fab-primary" aria-label="–Ø—Ä–∏–ª—Ü—å—è –Ω—ç—ç—Ö">
  <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M12 3a9 9 0 100 18 9 9 0 000-18zm1 13H8l5-5v5zm3-8H8v2h8V8z"/></svg>
  –Ø—Ä–∏–ª—Ü—å—è
</button>
<button id="oyOpen2" class="oy-fab oy-fab-secondary" aria-label="–Ø—Ä–∏–ª—Ü—å—è –Ω—ç—ç—Ö (–Ω”©”©)">
  <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M12 2a10 10 0 100 20 10 10 0 000-20zm-1 14l6-6-1.4-1.4L11 12.2 8.4 9.6 7 11–ª4 5z"/></svg>
  –Ø—Ä–∏–ª—Ü—å—è
</button>

<!-- –ë“Ø—Ä—Ö“Ø“Ø–ª + –ú–æ–¥–∞–ª -->
<div id="oyOverlay" class="oy-overlay" hidden></div>
<div id="oyModal" class="oy-modal" hidden role="dialog" aria-modal="true" aria-label="–ß–∞—Ç —Ü–æ–Ω—Ö">

  <div class="oy-topbar-spacer" aria-hidden="true"></div>

  <!-- –¢–æ–ª–≥–æ–π -->
  <header class="oy-header" id="oyHeader">
    <button id="btnDrawer" class="oy-iconbtn" aria-label="–ú–µ–Ω—é (—Ö–∞—Ä–∞–∞–≥“Ø–π)">
      <span class="braille">‚†ç‚†ë‚†ù‚†• ‚Äî –ú–ï–ù–Æ</span>
      <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M3 6h18v2H3zM3 11h18v2H3zM3 16h18v2H3z"/></svg>
    </button>
    <div id="chatTitle" class="oy-title">–û—é—É–Ω—Å–∞–Ω–∞–∞ ‚Äî –°–æ–Ω–≥–æ–ª—Ç–æ–æ —Ö–∏–π–Ω—ç “Ø“Ø</div>
    <button id="btnClose" class="oy-iconbtn" aria-label="–•–∞–∞—Ö">
      <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M6 6l12 12M18 6L6 18"/></svg>
    </button>
  </header>

  <!-- DRAWER / –ú–ï–ù–Æ -->
  <aside id="oyDrawer" class="oy-drawer" aria-label="–ú–µ–Ω—é">
    <div class="oy-menu">

      <!-- –ù—ç—Ä + –ö–æ–¥ -->
      <div class="oy-card">
        <div class="kv">–ù—ç—Ä: <b id="accName">–•—ç—Ä—ç–≥–ª—ç–≥—á</b></div>
        <div class="kv">–ö–æ–¥: <b id="accCode">OY-0000</b></div>
      </div>

      <!-- 10 –º–µ–Ω—é -->
      <div class="oy-item" data-menu="account">üìë –ú–∏–Ω–∏–π –±“Ø—Ä—Ç–≥—ç–ª</div>
      <div class="oy-item" data-menu="summary">ü§ùüèª –î“Ø–≥–Ω—ç–ª—Ç</div>
      <div class="oy-item" data-menu="daily">üìÖ ”®–¥”©—Ä —Ç—É—Ç–º—ã–Ω –¥–∞–∞–ª–≥–∞–≤–∞—Ä</div>
      <div class="oy-item" data-menu="journal">üìó ”®–¥—Ä–∏–π–Ω —Ç—ç–º–¥—ç–≥–ª—ç–ª ‚Üí –ù–æ–º</div>
      <div class="oy-item" data-menu="goals">üìà –ó–æ—Ä–∏–ª–≥–æ ¬∑ –¢”©–ª”©–≤–ª”©–≥”©”© ¬∑ –•—É–≤–∞–∞—Ä—å</div>
      <div class="oy-item" data-menu="edu">üß† –°—ç—Ç–≥—ç–ª–∏–π–Ω –±–æ–ª–æ–≤—Å—Ä–æ–ª</div>
      <div class="oy-item" data-menu="health">üèÉüèª‚Äç‚ôÇÔ∏è –•–æ–æ–ª ¬∑ –î–∞—Å–≥–∞–ª</div>
      <div class="oy-item" data-menu="reminders">‚è∞ –°–∞–Ω—É—É–ª–≥–∞</div>
      <div class="oy-item" data-menu="programs">‚úçüèª –ù—ç–º—ç–ª—Ç —Ö”©—Ç”©–ª–±”©—Ä</div>

      <!-- 10. –°—ç—Ç–≥—ç–ª–∏–π–Ω —Ö”©—Ç”©—á -->
      <div id="itemGuides" class="oy-item" data-menu="guides">
        <b>üó®Ô∏è –°—ç—Ç–≥—ç–ª–∏–π–Ω —Ö”©—Ç”©—á (—á–∞—Ç—É—É–¥)</b>
        <span class="braille">‚†é‚†ë‚†û‚†õ‚†ë‚†á‚†ä‚†Ø ‚†ì‚†¢‚†û‚†ë‚†Ø</span>
      </div>

      <section id="guidesWrap" class="oy-section" hidden aria-label="–°—ç—Ç–≥—ç–ª–∏–π–Ω —Ö”©—Ç”©—á ‚Äî –∂–∞–≥—Å–∞–∞–ª—Ç">
        <div class="hint">–ê–Ω–≥–∏–ª–∞–ª —Ç—É—Å –±“Ø—Ä –¥–æ–æ—Ä –±–∏—á–≥—ç—ç—Ä —è–ª–≥–∞–≤. –ù—ç–≥–∏–π–≥ –Ω—å –¥–∞—Ä–∂ —á–∞—Ç —Ä—É—É –æ—Ä–Ω–æ.</div>
        <!-- 15 —á–∞—Ç ‚Äî —ç–Ω–≥–∏–π–Ω—ç—ç—Ä —à—É—É–¥ –≥–∞—Ä–Ω–∞ -->
        <div id="guideList" class="oy-pills"></div>
      </section>

      <!-- –ò–¥—ç–≤—Ö—Ç—ç–π —á–∞—Ç—É—É–¥ -->
      <section id="activeWrap" class="oy-section">
        <h4>–ò–¥—ç–≤—Ö—Ç—ç–π —á–∞—Ç—É—É–¥</h4>
        <div id="activeList"></div>
      </section>
    </div>

    <!-- –ü–∞–Ω–µ–ª (–º–µ–Ω—é–≥–∏–π–Ω –¥–æ—Ç–æ—Ä—Ö) -->
    <div id="oyPanel" class="oy-panel" hidden>
      <header>
        <button id="oyPanelBack" class="oy-back">–ë—É—Ü–∞—Ö</button>
        <div id="oyPanelTitle" class="oy-panel-title">–ü–∞–Ω–µ–ª</div>
      </header>
      <div id="oyPanelBody" class="oy-panel-body"></div>
    </div>
  </aside>

  <!-- –ß–ê–¢ -->
  <main class="oy-chat" id="oyChat">
    <div id="oyStream" class="oy-stream"></div>
  </main>

  <!-- –ö–æ–º–ø–æ—É–∑–µ—Ä -->
  <div class="oy-composer">
    <div class="oy-row">
      <label for="oyFile" class="oy-file" aria-label="–§–∞–π–ª/–∑—É—Ä–∞–≥ –Ω—ç–º—ç—Ö" title="–§–∞–π–ª/–∑—É—Ä–∞–≥ –Ω—ç–º—ç—Ö">
        <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M21 8.5l-8.485 8.485a5 5 0 11-7.071-7.071L14.5 1.858a3.5 3.5 0 114.95 4.95L9.88 16.379a2 2 0 11-2.828-2.828L16 4.603" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"/></svg>
      </label>
      <input id="oyFile" type="file" multiple accept="image/*,.pdf" hidden>
      <textarea id="oyInput" class="oy-textarea" rows="1" placeholder="–≠–Ω–¥ –±–∏—á—ç—ç–¥ Enter –¥–∞—Ä–Ω–∞ —É—É‚Ä¶"></textarea>
      <button id="btnSend" class="oy-send" title="–ò–ª–≥—ç—ç—Ö">
        <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M2 21l21-9L2 3v7l15 2-15 2z"/></svg>
      </button>
    </div>
  </div>

</div>

<script>
(()=>{

  const $ = (s,r=document)=>r.querySelector(s);

  const el = {
    open1: $('#oyOpen1'), open2: $('#oyOpen2'),
    overlay: $('#oyOverlay'), modal: $('#oyModal'),
    header: $('#oyHeader'), title: $('#chatTitle'),
    drawer: $('#oyDrawer'), menu: $('.oy-menu'),
    itemGuides: $('#itemGuides'), guidesWrap: $('#guidesWrap'),
    guideList: $('#guideList'),
    activeWrap: $('#activeWrap'), activeList: $('#activeList'),
    panel: $('#oyPanel'), pBack: $('#oyPanelBack'),
    pTitle: $('#oyPanelTitle'), pBody: $('#oyPanelBody'),
    chat: $('#oyChat'), stream: $('#oyStream'),
    file: $('#oyFile'), input: $('#oyInput'), send: $('#btnSend'),
    btnDrawer: $('#btnDrawer'), btnClose: $('#btnClose'),
    accName: $('#accName'), accCode: $('#accCode'),
  };

  /* ====== ”®–ì”®–ì–î”®–õ ====== */
  // 15 —á–∞—Ç (”©–Ω–≥”© –Ω—å UI –¥—ç—ç—Ä –∫–æ–¥–æ–æ—Ä —Ö–∞—Ä–∞–≥–¥–∞—Ö–≥“Ø–π ‚Äî –¥–æ—Ç–æ–æ–¥–¥–æ–æ –ª —Ö—ç—Ä—ç–≥–ª—ç–Ω—ç)
  const CHATS = [
    // –ù–∞—Å
    {slug:'age-0-7',  group:'–ù–∞—Å–Ω—ã –∞–Ω–≥–∏–ª–∞–ª', name:'–ë–∞–≥–∞ –±–∞–ª—á–∏—Ä “Ø–µ (0‚Äì7)',           color:'#E1D9C9'},
    {slug:'age-8-12', group:'–ù–∞—Å–Ω—ã –∞–Ω–≥–∏–ª–∞–ª', name:'–ê–¥—Ç–∞–π –±—è—Ü—Ö–∞–Ω “Ø–µ (8‚Äì12)',         color:'#AE9372'},
    {slug:'age-13-18',group:'–ù–∞—Å–Ω—ã –∞–Ω–≥–∏–ª–∞–ª', name:'–°—ç—Ä–≥—ç–ª—ç–Ω ”©—Å–≤”©—Ä “Ø–µ (13‚Äì18)',      color:'#B27D57'},
    {slug:'age-19-25',group:'–ù–∞—Å–Ω—ã –∞–Ω–≥–∏–ª–∞–ª', name:'–≠—Ö–ª—ç–ª, –º”©—Ä”©”©–¥–ª–∏–π–Ω “Ø–µ (19‚Äì25)',  color:'#7F4B30'},
    {slug:'age-26-40',group:'–ù–∞—Å–Ω—ã –∞–Ω–≥–∏–ª–∞–ª', name:'–≠—Ä—Ö —á”©–ª”©”©—Ç, —ç—Ä—á —Ö“Ø—á—Ç—ç–π “Ø–µ (26‚Äì40)', color:'#A28776'},
    {slug:'age-41-55',group:'–ù–∞—Å–Ω—ã –∞–Ω–≥–∏–ª–∞–ª', name:'–¢—É—Ä—à–ª–∞–≥–∞, –±“Ø—Ç—ç—ç–ª–∏–π–Ω “Ø–µ (41‚Äì55)', color:'#7D8769'},
    {slug:'age-56-70',group:'–ù–∞—Å–Ω—ã –∞–Ω–≥–∏–ª–∞–ª', name:'–£—Ö–∞–∞–Ω, –Ω”©–ª”©”©–ª–ª–∏–π–Ω “Ø–µ (56‚Äì70)',  color:'#424C21'},
    {slug:'age-70p',  group:'–ù–∞—Å–Ω—ã –∞–Ω–≥–∏–ª–∞–ª', name:'”®–≤–ª”©–∂, “Ø–ª–¥—ç—ç—Ö “Ø–µ (70+)',         color:'#173125'},
    // –ë–∞–≥—Ü
    {slug:'fam',      group:'–ë–∞–≥—Ü', name:'–ì—ç—Ä –±“Ø–ª',              color:'#D8A48F'},
    {slug:'career',   group:'–ë–∞–≥—Ü', name:'–ê–∂–∏–ª –º—ç—Ä–≥—ç–∂–ª–∏–π–Ω',      color:'#957C60'},
    {slug:'class',    group:'–ë–∞–≥—Ü', name:'–ê–Ω–≥–∏ —Ö–∞–º—Ç –æ–ª–æ–Ω',       color:'#EFEBCE'},
    {slug:'sport',    group:'–ë–∞–≥—Ü', name:'–°–ø–æ—Ä—Ç, —É—Ä–ª–∞–≥–∏–π–Ω',      color:'#ABAC97'},
    {slug:'org',      group:'–ë–∞–≥—Ü', name:'–ë–∞–π–≥—É—É–ª–ª–∞–≥–∞',          color:'#433A29'},
    // –¢—É—Å–≥–∞–π
    {slug:'vision',   group:'–¢—É—Å–≥–∞–π —Ö—ç—Ä—ç–≥—Ü—ç—ç—Ç', name:'–•–∞—Ä–∞–∞–Ω—ã –±—ç—Ä—Ö—à—ç—ç–ª—Ç—ç–π', color:'#353326'},
    {slug:'special',  group:'–¢—É—Å–≥–∞–π —Ö—ç—Ä—ç–≥—Ü—ç—ç—Ç', name:'–¢—É—Å–≥–∞–π —Ö—ç—Ä—ç–≥—Ü—ç—ç—Ç',     color:'#897E45'},
  ];

  // –¢”©–ª”©–≤ (localStorage)
  const LSKEY = 'oy_state_v1';
  let state = {
    account: {name:'–•—ç—Ä—ç–≥–ª—ç–≥—á', code:'OY-0000'},
    current: null,   // "slug"
    active: {},      // slug -> {name,color}
  };
  try{ const s = JSON.parse(localStorage.getItem(LSKEY)||'null'); if(s) state = {...state, ...s}; }catch(_){}
  const save = ()=> localStorage.setItem(LSKEY, JSON.stringify(state));

  /* ====== –ù—ç—ç—Ö/—Ö–∞–∞—Ö ====== */
  function openModal(){ el.modal.hidden=false; el.overlay.hidden=false; bootOnce(); }
  function closeModal(){ el.modal.hidden=true; el.overlay.hidden=true; closeDrawer(); save(); }
  function toggleDrawer(){
    const open = !el.drawer.classList.contains('open');
    el.drawer.classList.toggle('open', open);
    document.body.style.overflow = open ? 'hidden' : '';
  }
  function closeDrawer(){ el.drawer.classList.remove('open'); document.body.style.overflow=''; }

  /* ====== Bubble ====== */
  function bubble(html, who='bot'){
    const d=document.createElement('div');
    d.className='oy-bubble '+(who==='user'?'oy-user':'oy-bot');
    d.innerHTML=html; el.stream.appendChild(d);
    el.chat.scrollTop=el.chat.scrollHeight;
  }
  const meta = t=>{ const m=document.createElement('div'); m.className='oy-meta'; m.textContent=t; el.stream.appendChild(m); };

  /* ====== Helpers ====== */
  function textColorFor(hex){
    const c = hex.replace('#',''); const r=parseInt(c.substr(0,2),16), g=parseInt(c.substr(2,2),16), b=parseInt(c.substr(4,2),16);
    const L=(0.299*r+0.587*g+0.114*b)/255; return L>0.7?'#111':'#fff';
  }
  function esc(s){return String(s).replace(/[&<>"']/g,m=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' }[m]));}

  /* ====== –°—ç—Ç–≥—ç–ª–∏–π–Ω —Ö”©—Ç”©—á: 15 —á–∞—Ç—ã–≥ —à—É—É–¥ –ª–∏—Å—Ç –±–æ–ª–≥–æ—Ö ====== */
  function renderAllChats(){
    el.guideList.innerHTML='';
    // ‚Äú–ù–∞—Å–Ω—ã –∞–Ω–≥–∏–ª–∞–ª‚Äù, ‚Äú–ë–∞–≥—Ü‚Äù, ‚Äú–¢—É—Å–≥–∞–π —Ö—ç—Ä—ç–≥—Ü—ç—ç—Ç‚Äù –≥—ç—Å—ç–Ω –±“Ø–ª–≥–∏–π–Ω –≥–∞—Ä—á–≥–∏–π–≥ —Ç–µ–∫—Å—Ç—ç—ç—Ä —Ç—É—Å–≥–∞–∞—Ä–ª–∞–Ω–∞
    const groups = ['–ù–∞—Å–Ω—ã –∞–Ω–≥–∏–ª–∞–ª','–ë–∞–≥—Ü','–¢—É—Å–≥–∞–π —Ö—ç—Ä—ç–≥—Ü—ç—ç—Ç'];
    groups.forEach(gr=>{
      const h = document.createElement('div');
      h.className='hint'; h.textContent = gr;
      el.guideList.appendChild(h);
      CHATS.filter(x=>x.group===gr).forEach(it=>{
        const pill = document.createElement('div');
        pill.className='oy-pill';
        pill.style.setProperty('--c', it.color);
        pill.style.setProperty('--tc', textColorFor(it.color));
        pill.innerHTML = `<span>${esc(it.name)}</span>`;
        pill.onclick = ()=> selectChat(it);
        el.guideList.appendChild(pill);
      });
    });
  }

  function selectChat(it){
    state.current = it.slug;
    state.active[it.slug] = {name:it.name, color:it.color};
    save(); redrawActive();
    el.title.textContent = `–û—é—É–Ω—Å–∞–Ω–∞–∞ ‚Äî ${it.name}`;
    closeDrawer();
    loadChat(it.slug, true);
  }

  function redrawActive(){
    el.activeList.innerHTML='';
    Object.entries(state.active).forEach(([slug,meta])=>{
      const row=document.createElement('div'); row.className='item';
      const dot=document.createElement('span'); dot.className='dot'; dot.style.background=meta.color;
      const name=document.createElement('div'); name.className='name'; name.textContent=meta.name;
      const x=document.createElement('button'); x.textContent='√ó'; x.title='–ò–¥—ç–≤—Ö—Ç—ç—ç–≥—ç—ç—Å —Ö–∞—Å–∞—Ö';
      name.onclick=()=>{ state.current=slug; save(); el.title.textContent=`–û—é—É–Ω—Å–∞–Ω–∞–∞ ‚Äî ${meta.name}`; loadChat(slug,false); closeDrawer(); };
      x.onclick=(e)=>{ e.stopPropagation(); delete state.active[slug]; if(state.current===slug) state.current=null; save(); redrawActive(); };
      row.append(dot,name,x); el.activeList.appendChild(row);
    });
  }

  function storageKey(slug){return `oy_msgs_${slug}`;}
  function loadChat(slug, greetIfEmpty){
    el.stream.innerHTML='';
    const raw=localStorage.getItem(storageKey(slug));
    if(raw){
      try{ (JSON.parse(raw)||[]).forEach(m=>bubble(m.html, m.who)); }catch(_){}
    }else if(greetIfEmpty){
      bubble('–°–∞–π–Ω —É—É, —Ö–∞–π—Ä—Ç –º–∏–Ω—å. –ß–∏–Ω–∏–π —Å–æ–Ω–≥–æ—Å–æ–Ω —á–∞—Ç–∞–∞—Ä —Ç–∞–π–≤–∞–Ω –∞—è–ª—ä—è. üåø','bot');
      meta('–ß–∞—Ç —ç—Ö—ç–ª–ª—ç—ç');
    }
    setTimeout(()=> el.input.focus(), 40);
  }
  function pushMsg(slug, who, html){
    const k=storageKey(slug);
    const arr=JSON.parse(localStorage.getItem(k)||'[]');
    arr.push({t:Date.now(), who, html});
    localStorage.setItem(k, JSON.stringify(arr));
  }

  /* ====== –ü–∞–Ω–µ–ª—É—É–¥ (–∂–∏—á: –æ–¥–æ–æ—Ö–æ–Ω–¥–æ–æ placeholder) ====== */
  const PANEL = {
    account:{title:'–ú–∏–Ω–∏–π –±“Ø—Ä—Ç–≥—ç–ª', html:`<div class="card"><b>–°—É—É—Ä—å –º—ç–¥—ç—ç–ª—ç–ª</b><div class="muted">–ù—ç—Ä, –ö–æ–¥ –Ω—å —Å–∞–π—Ç—ã–Ω –±“Ø—Ä—Ç–≥—ç–ª—ç—ç—Å –∞–≤—Ç–æ–º–∞—Ç–∞–∞—Ä –æ—Ä–Ω–æ.</div></div>`},
    summary:{title:'–î“Ø–≥–Ω—ç–ª—Ç', html:`<div class="card"><b>–ê–Ω—Ö–Ω—ã –∑—É—Ä–∞–≥</b><div class="muted">–£–Ω—Ç–∞–ª—Ç, —É—Å, –∞–ª—Ö–∞–ª—Ç, —Å—Ç—Ä–µ—Å—Å</div></div>`},
    daily:{title:'”®–¥”©—Ä —Ç—É—Ç–º—ã–Ω –¥–∞–∞–ª–≥–∞–≤–∞—Ä', html:`<div class="card"><b>30 ”©–¥—Ä–∏–π–Ω —á–µ–∫–ª–∏—Å—Ç</b></div>`},
    journal:{title:'”®–¥—Ä–∏–π–Ω —Ç—ç–º–¥—ç–≥–ª—ç–ª ‚Üí –ù–æ–º', html:`<div class="card"><b>–ß”©–ª”©”©—Ç –±–∏—á–≤—ç—Ä</b></div>`},
    goals:{title:'–ó–æ—Ä–∏–ª–≥–æ ¬∑ –¢”©–ª”©–≤–ª”©–≥”©”© ¬∑ –•—É–≤–∞–∞—Ä—å', html:`<div class="card"><b>–¢–æ–º –∑–æ—Ä–∏–ª–≥–æ</b></div>`},
    edu:{title:'–°—ç—Ç–≥—ç–ª–∏–π–Ω –±–æ–ª–æ–≤—Å—Ä–æ–ª', html:`<div class="card"><b>–ë—è—Ü—Ö–∞–Ω —Ö–∏—á—ç—ç–ª“Ø“Ø–¥</b></div>`},
    health:{title:'–•–æ–æ–ª ¬∑ –î–∞—Å–≥–∞–ª', html:`<div class="card"><b>–£—Å / –ö–∞–ª–æ—Ä–∏ / –î–∞—Å–≥–∞–ª</b></div>`},
    reminders:{title:'–°–∞–Ω—É—É–ª–≥–∞', html:`<div class="card"><b>–ö–∞–ª–µ–Ω–¥–∞—Ä—å —Å–∞–Ω—É—É–ª–≥—É—É–¥</b></div>`},
    programs:{title:'–ù—ç–º—ç–ª—Ç —Ö”©—Ç”©–ª–±”©—Ä', html:`<div class="card"><b>–ñ–∏—à—ç—ç –±–∞–≥—Ü</b></div>`},
  };
  function showPanel(key){
    const p=PANEL[key]; if(!p) return;
    el.pTitle.textContent=p.title; el.pBody.innerHTML=p.html; el.panel.hidden=false;
    el.pBack.onclick=()=> el.panel.hidden=true;
  }

  /* ====== Boot ====== */
  function bootOnce(){
    if(el.modal.dataset.boot) return; el.modal.dataset.boot='1';
    // –ù—ç—Ä/–ö–æ–¥ (—Å–∞–π—Ç–∞–∞—Å –¥–∞—Ä–∞–∞ –Ω—å oySetAccount-–∞–∞—Ä —à–∏–Ω—ç—á–ª—ç–≥–¥—ç–Ω—ç)
    el.accName.textContent = state.account.name||'–•—ç—Ä—ç–≥–ª—ç–≥—á';
    el.accCode.textContent = state.account.code||'OY-0000';

    // –°—ç—Ç–≥—ç–ª–∏–π–Ω —Ö”©—Ç—á–∏–π–Ω –ª–∏—Å—Ç–∏–π–≥ –Ω—ç–≥ –¥–æ—Ä —Ä—ç–Ω–¥—ç—Ä–ª—ç–Ω—ç
    renderAllChats();
    redrawActive();

    // ”®–º–Ω”©—Ö —á–∞—Ç
    if(state.current && state.active[state.current]){
      el.title.textContent = `–û—é—É–Ω—Å–∞–Ω–∞–∞ ‚Äî ${state.active[state.current].name}`;
      loadChat(state.current,false);
    }else{
      bubble('–°–∞–π–Ω —É—É, —Ö–∞–π—Ä—Ç –º–∏–Ω—å. –°—ç—Ç–≥—ç–ª–∏–π–Ω —Ö”©—Ç”©—á”©”©—Å —á–∞—Ç —Å–æ–Ω–≥–æ–æ–¥ —è—Ä–∏–ª—Ü—ä—è. üå∏','bot');
      meta('–≠—Ö—ç–ª–ª—ç—ç');
    }
  }

  /* ====== Events ====== */
  el.open1.onclick=openModal; el.open2.onclick=openModal;
  el.overlay.onclick=closeModal; el.btnClose.onclick=closeModal;
  el.btnDrawer.onclick=(e)=>{e.preventDefault();e.stopPropagation();toggleDrawer();};

  // –ú–µ–Ω—é item-—É—É–¥
  el.menu.addEventListener('click', (e)=>{
    const it = e.target.closest('.oy-item'); if(!it) return;
    const key = it.dataset.menu;
    if(key==='guides'){
      const open = el.guidesWrap.hidden;
      el.guidesWrap.hidden = !open;      // –Ω—ç—ç–≥–¥—ç–Ω—ç/—Ö–∞–∞–≥–¥–∞–Ω–∞
      // –Ω—ç—ç–≥–¥—ç—Ö—ç–¥ ‚Äú–ò–¥—ç–≤—Ö—Ç—ç–π —á–∞—Ç—É—É–¥‚Äù-—ã–≥ –¥–æ–æ—à –Ω—å —à–∏–ª–∂“Ø“Ø–ª—å–µ
      if(open) el.menu.appendChild(el.activeWrap); else el.menu.insertBefore(el.activeWrap, el.itemGuides.nextSibling);
      return;
    }
    // –ë—É—Å–∞–¥ –Ω—å –ø–∞–Ω–µ–ª
    el.guidesWrap.hidden=true;
    el.menu.insertBefore(el.activeWrap, el.itemGuides.nextSibling);
    showPanel(key);
  });

  // –≠–Ω–¥ —Ç—ç–Ω–¥ –¥–∞—Ä–≤–∞–ª drawer —Ö–∞–∞–≥–¥–∞–Ω–∞
  document.addEventListener('click', (e)=>{
    if(!el.drawer.classList.contains('open')) return;
    if(e.target.closest('#oyDrawer')) return;
    if(e.target.closest('#btnDrawer')) return;
    closeDrawer();
  }, true);

  // –ë–∏—á–∏–∂ —ç—Ö–ª—ç—Ö—ç–¥ –º”©–Ω —Ö–∞–∞—è
  el.input.addEventListener('focus', ()=>{ if(el.drawer.classList.contains('open')) closeDrawer(); });

  // –ò–ª–≥—ç—ç—Ö
  function send(){
    const t=(el.input.value||'').trim(); if(!t) return;
    if(!state.current){ bubble('–≠—Ö–ª—ç—ç–¥ –°—ç—Ç–≥—ç–ª–∏–π–Ω —Ö”©—Ç”©—á”©”©—Å —á–∞—Ç —Å–æ–Ω–≥–æ–æ—Ä–æ–π. üåø','bot'); el.input.value=''; return; }
    bubble(esc(t),'user'); pushMsg(state.current,'user',esc(t)); el.input.value='';
    setTimeout(()=>{ const ans='–°–æ–Ω—Å–æ–∂ –±–∞–π–Ω–∞, –∞–º—Ä–∞–≥ –º–∏–Ω—å. –ê–º—å—Å–≥–∞–ª–∞–∞ –∑”©”©–ª”©–Ω –∞–≤–∞–∞–¥‚Ä¶ —è—Ä–∏–ª—Ü—ä—è. üí¨';
      bubble(ans,'bot'); pushMsg(state.current,'bot',ans); save(); },140);
  }
  el.send.onclick=send;
  el.input.addEventListener('keydown',(e)=>{ if(e.key==='Enter'&&!e.shiftKey){ e.preventDefault(); send(); }});

  // –§–∞–π–ª
  el.file.addEventListener('change',(e)=>{
    if(!state.current){ e.target.value=''; return; }
    const names=[...e.target.files].map(f=>f.name).slice(0,3).join(', ');
    if(names){ bubble(`–•–∞–≤—Å–∞—Ä–≥–∞—Å–∞–Ω: <i>${esc(names)}</i>`,'user'); pushMsg(state.current,'user',`–•–∞–≤—Å–∞—Ä–≥–∞—Å–∞–Ω: <i>${esc(names)}</i>`); save(); }
    e.target.value='';
  });

  // –ì–∞–¥—É—É—Ä—Ö–∞–∞—Å –Ω—ç—Ä/–∫–æ–¥ –æ–Ω–æ–æ—Ö API (—Å–∞–π—Ç–Ω–∞–∞—Å–∞–∞ –¥—É—É–¥–∞–∞—Ä–∞–π)
  window.oySetAccount = function({name,code}={}){
    if(name) state.account.name=name;
    if(code) state.account.code=code;
    el.accName.textContent=state.account.name||'–•—ç—Ä—ç–≥–ª—ç–≥—á';
    el.accCode.textContent=state.account.code||'OY-0000';
    save();
  };

})();
</script>
</body>
</html>
