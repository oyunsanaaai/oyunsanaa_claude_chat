<!DOCTYPE html>
<html lang="mn">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>–û—é—É–Ω—Å–∞–Ω–∞–∞ ‚Äî –°—ç—Ç–≥—ç–ª–∏–π–Ω —Ö”©—Ç”©—á</title>

  <!-- –§–æ–Ω—Ç -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&family=Montserrat:wght@600&display=swap" rel="stylesheet">

  <style>
    :root{
      --brand:#800000;           /* –≥–∞–¥–∞–∞–¥ —Ç–æ–≤—á, –º–µ–Ω—é –∞–∫—Ü–µ–Ω—Ç */
      --chat:#075E54;            /* —á–∞—Ç–Ω—ã —Ç–æ–ª–≥–æ–π + –∏–ª–≥—ç—ç—Ö/–∫–ª–∏–ø */
      --bg:#fff;
      --wall:#fafafa;            /* —á–∞—Ç —Ö–∞–Ω—ã–Ω —Ñ–æ–Ω */
      --text:#222;
      --muted:#8a8a8a;
      --bot:#fff;
      --user:#e8f5e9;
      --shadow:0 10px 30px rgba(0,0,0,.12);
      --t:14px;
      --font-ui:"Inter", system-ui, -apple-system, "Segoe UI", Arial, sans-serif;
      --font-title:"Montserrat", var(--font-ui);
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;background:var(--bg);color:var(--text);font:400 var(--t)/1.5 var(--font-ui)}

    /* === Floating open buttons (–≥–∞–¥–∞–∞–¥) ========================= */
    .oy-fab{position:fixed;right:18px;bottom:20px;padding:10px 14px;border-radius:999px;
      display:flex;gap:8px;align-items:center;box-shadow:var(--shadow);cursor:pointer;
      border:1px solid transparent;z-index:9998}
    .oy-fab svg{width:18px;height:18px;fill:#fff}
    .oy-fab-primary{background:var(--brand);color:#fff}
    .oy-fab-outline{bottom:68px;background:var(--chat);color:#fff;border-color:var(--chat)}
    .oy-fab-outline svg{fill:#fff}
    @media (max-width:520px){.oy-fab-primary{right:20px;bottom:20px}.oy-fab-outline{right:20px;bottom:68px}}

    /* === Overlay + Modal shell ================================= */
    .oy-overlay{position:fixed;inset:0;background:rgba(0,0,0,.35);z-index:9999}
    .oy-modal{position:fixed;z-index:10000;right:16px;bottom:82px;width:100%;max-width:420px;height:80vh;max-height:720px;
      background:#fff;border-radius:20px;box-shadow:var(--shadow);display:flex;flex-direction:column;overflow:hidden}
    @media (max-width:520px){.oy-modal{right:0;left:0;bottom:0;width:100%;height:100vh;max-height:100vh;border-radius:0}}
    [hidden]{display:none!important}

    /* === Header (–Ω–æ–≥–æ–æ–Ω) ======================================= */
    .oy-header{position:sticky;top:0;height:56px;background:var(--chat);color:#fff;display:flex;align-items:center;z-index:2}
    .oy-iconbtn{width:44px;height:44px;margin:0 4px;display:grid;place-items:center;background:transparent;border:none;color:#fff;cursor:pointer;position:relative}
    .oy-iconbtn svg{width:18px;height:18px;fill:#fff}
    .oy-iconbtn.with-braille::after{content:attr(data-braille);position:absolute;left:100%;top:50%;transform:translateY(-50%);font:400 8px var(--font-ui);color:rgba(255,255,255,0.7);margin-left:4px;white-space:nowrap}
    .oy-title{flex:1;text-align:center;font:400 15px var(--font-ui);padding-right:6px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}

    /* === Drawer (–º–µ–Ω—é) ========================================= */
    .oy-drawer{position:absolute;inset:0 auto 0 0;width:84%;max-width:390px;background:#fff;border-right:1px solid #eee;transform:translateX(-102%);transition:transform .25s ease;z-index:3}
    .oy-drawer.open{transform:translateX(0)}
    .oy-menulist{height:calc(100% - 56px);overflow-y:auto;overflow-x:hidden;padding:18px}
    .account-info{padding:2px 2px 14px;position:relative;z-index:4;background:#fff}
    .acc{background:#f8f8f8;border:1px solid #eee;border-radius:14px;padding:12px 14px;display:flex;align-items:center;gap:10px;margin-bottom:10px;cursor:pointer;transition:background .2s;min-height:44px}
    .acc:hover{background:#f0f0f0}
    .acc .i{width:20px;height:20px;display:grid;place-items:center;flex-shrink:0}
    .acc .t{font:400 14px var(--font-ui);line-height:1.3;flex:1}
    .acc svg{width:18px;height:18px;fill:var(--brand)}
    .sec-title{font:400 12px var(--font-ui);color:#666;margin:15px 0 8px;text-transform:uppercase;letter-spacing:.3px}

    /* === Guides (—á–∞—Ç —Å–æ–Ω–≥–æ—Ö) =================================== */
    .group-title{font:400 11px var(--font-ui);letter-spacing:.4px;margin:15px 0 8px;color:#666;text-transform:uppercase;font-weight:500}
    .oy-pills{display:flex;flex-direction:column;gap:8px;margin-bottom:15px}
    .oy-pill{--c:#ddd;--tc:#111;background:var(--c);color:var(--tc);border-radius:12px;padding:12px 14px;border:1px solid rgba(0,0,0,.06);cursor:pointer;transition:transform .2s ease;min-height:44px;display:flex;align-items:center}
    .oy-pill:hover{transform:translateY(-1px)}
    .oy-pill span{font:400 14px var(--font-ui);line-height:1.3}

    /* === Active list =========================================== */
    .active-item{background:#f8f8f8;border:1px solid #eee;border-radius:12px;padding:10px 12px;margin-top:8px;display:flex;justify-content:space-between;align-items:center;min-height:40px}
    .active-item .rm{background:#eee;border:none;border-radius:6px;padding:4px 8px;cursor:pointer;font:400 11px var(--font-ui)}
    .dot{width:8px;height:8px;border-radius:50%;display:inline-block;margin-right:8px;vertical-align:middle;flex-shrink:0}
    .active-item span{font:400 13px var(--font-ui);line-height:1.3}

    /* === Chat area ============================================= */
    .oy-chat{flex:1;background:var(--wall);}
    .oy-stream{padding:12px 14px 120px;overflow:auto;height:100%}
    .msg{max-width:90%;padding:10px 14px;border-radius:14px;margin:8px 0;box-shadow:0 2px 8px rgba(0,0,0,.06)}
    .msg.user{margin-left:auto;background:var(--user)}
    .msg.bot{background:var(--bot)}
    .stamp{font-size:12px;color:#999;margin:0 14px}

    /* === Composer (–∫–ª–∏–ø + –∏–ª–≥—ç—ç—Ö –ù–û–ì–û–û–ù) ====================== */
    .oy-composer{position:absolute;left:0;right:0;bottom:0;background:linear-gradient(to top, #fff 60%, transparent);padding:10px 12px}
    .oy-row{display:flex;gap:10px;align-items:center}
    .oy-textarea{flex:1;border:1px solid #e5e5e5;border-radius:12px;padding:12px 14px;min-height:44px;max-height:120px;resize:vertical}
    .oy-file{width:38px;height:38px;display:grid;place-items:center;border:1px solid var(--chat);border-radius:10px;color:var(--chat);background:#fff;cursor:pointer;transition:all .2s ease}
    .oy-file:hover{background:var(--chat);color:#fff;transform:scale(1.05)}
    .clip::before{content:'üìé';display:block;font-size:16px}
    .oy-send{width:48px;height:44px;border:none;border-radius:12px;background:var(--chat);color:#fff;display:grid;place-items:center;cursor:pointer}
    .icon-send{width:18px;height:18px;display:block;background:#fff;mask:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M2 21l20-9L2 3l5 7-5 7zm5-7l15-2-15-2 4 2-4 2z"/></svg>') no-repeat center/contain}

    /* === Menu Content Areas =================================== */
    .menu-content{display:none;padding:0}
    .menu-content.active{display:block}

    /* === Tooltips (–∑”©–≤—Ö”©–Ω 4 –≥–∞–∑–∞—Ä—Ç) =========================== */
    .simple-tooltip{position:relative}
    .simple-tooltip:hover::after{
      content:attr(data-tip);
      position:absolute;
      background:rgba(255,255,255,0.95);
      color:#333;
      padding:4px 8px;
      border-radius:4px;
      font:400 11px var(--font-ui);
      white-space:nowrap;
      z-index:1000;
      box-shadow:0 2px 8px rgba(0,0,0,0.15);
      border:1px solid #eee;
      display:none;
    }
    .tip-right:hover::after{left:100%;top:50%;transform:translateY(-50%);margin-left:8px}
    .tip-left:hover::after{right:100%;top:50%;transform:translateY(-50%);margin-right:8px}

    /* === –ñ–∏–∂–∏–≥ –±–∏—á–∏–≥ –Ω—ç–º—ç—Ö ==================================== */
    .with-text{position:relative}
    .menu-text{font:400 10px var(--font-ui);color:#666;margin-left:2px}
    .chat-text{font:400 10px var(--font-ui);color:#666;margin-left:2px}
    .special-text{font:400 10px var(--font-ui);color:#666;margin-top:2px}

    /* === Simple helpers ======================================= */
    .hide{display:none!important}
    .collapse{
      max-height:0;
      overflow:hidden;
      transition:max-height .4s ease-out;
      opacity:0;
      transform:translateY(-10px);
    }
    .collapse.show{
      max-height:2000px;
      opacity:1;
      transform:translateY(0);
      transition:max-height .4s ease-in, opacity .3s ease-in .1s, transform .3s ease-in .1s;
    }
  </style>
</head>
<body>

  <!-- –ì–∞–¥–∞–∞–¥ "–Ø—Ä–∏–ª—Ü—ä—è" —Ç–æ–≤—á–Ω—É—É–¥ -->
  <button id="oyOpen1" class="oy-fab oy-fab-primary" aria-label="–Ø—Ä–∏–ª—Ü—ä—è">
    <svg viewBox="0 0 24 24"><path d="M2 21l20-9L2 3l5 7-5 7z"/></svg> –Ø—Ä–∏–ª—Ü—ä—è
  </button>
  <button id="oyOpen2" class="oy-fab oy-fab-outline" aria-label="–Ø—Ä–∏–ª—Ü—ä—è">
    <svg viewBox="0 0 24 24"><path d="M2 21l20-9L2 3l5 7-5 7z"/></svg> –Ø—Ä–∏–ª—Ü—ä—è
  </button>

  <!-- Overlay + Modal -->
  <div id="oyOverlay" class="oy-overlay" hidden></div>

  <div id="oyModal" class="oy-modal" hidden role="dialog" aria-modal="true" aria-label="–ß–∞—Ç —Ü–æ–Ω—Ö">
    <header class="oy-header">
      <button id="btnDrawer" class="oy-iconbtn with-braille" data-braille="‚†ç‚†ë‚†ù‚†Ω‚†•" title="–ú–µ–Ω—é">
        <svg viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
      </button>
      <div id="chatTitle" class="oy-title">–û—é—É–Ω—Å–∞–Ω–∞–∞ ‚Äî –°—ç—Ç–≥—ç–ª–∏–π–Ω —Ö”©—Ç”©—á</div>
      <button id="btnClose" class="oy-iconbtn" title="–•–∞–∞—Ö">
        <svg viewBox="0 0 24 24"><path d="M18.3 5.7L12 12l6.3 6.3-1.4 1.4L10.6 13.4 4.3 19.7 2.9 18.3 9.2 12 2.9 5.7 4.3 4.3l6.3 6.3 6.3-6.3z"/></svg>
      </button>
    </header>

    <!-- Drawer / –ú–µ–Ω—é -->
    <aside id="oyDrawer" class="oy-drawer" aria-label="–ú–µ–Ω—é">
      <div class="oy-menulist" id="menu">
        <div class="account-info">
          <div style="font:400 16px var(--font-ui)">–ù—ç—Ä: <span id="accName">–•—ç—Ä—ç–≥–ª—ç–≥—á</span></div>
          <div style="color:#666;font:400 13px var(--font-ui)">–ö–æ–¥: <span id="accCode">OY-0000</span></div>
        </div>

        <!-- 10 –º–µ–Ω—é -->
        <div class="acc" data-menu="profile"><span class="i"><svg viewBox="0 0 24 24"><path d="M12 12a5 5 0 100-10 5 5 0 000 10zm0 2c-5 0-9 2.5-9 5.5V22h18v-2.5C21 16.5 17 14 12 14z"/></svg></span><span class="t">–ú–∏–Ω–∏–π –±“Ø—Ä—Ç–≥—ç–ª <span style="font:400 9px var(--font-ui);color:#999">‚†ç‚†ä‚†ù‚†ä‚†ä ‚†É‚†•‚†ó‚†û‚†õ‚†ë‚†á</span></span></div>
        <div class="acc" data-menu="report"><span class="i"><svg viewBox="0 0 24 24"><path d="M3 3h18v2H3zm0 7h12v2H3zm0 7h18v2H3z"/></svg></span><span class="t">–î“Ø–Ω–≥–ª—ç–ª</span></div>
        <div class="acc" data-menu="goals"><span class="i"><svg viewBox="0 0 24 24"><path d="M12 2l4 7H8l4-7zm0 9l4 7H8l4-7z"/></svg></span><span class="t">–ó–æ—Ä–∏–ª–≥–æ ¬∑ –¢”©–ª”©–≤–ª”©–≥”©”© ¬∑ –•—É–≤–∞–∞—Ä—å</span></div>
        <div class="acc" data-menu="tasks"><span class="i"><svg viewBox="0 0 24 24"><path d="M19 3H5v18l7-3 7 3V3z"/></svg></span><span class="t">”®–¥”©—Ä —Ç—É—Ç–º—ã–Ω –¥–∞–∞–ª–≥–∞–≤–∞—Ä</span></div>
        <div class="acc" data-menu="diary"><span class="i"><svg viewBox="0 0 24 24"><path d="M4 6h16v2H4zm0 5h10v2H4zm0 5h16v2H4z"/></svg></span><span class="t">”®–¥—Ä–∏–π–Ω —Ç—ç–º–¥—ç–≥–ª—ç–ª ‚Üí –ù–æ–º</span></div>
        <div class="acc" data-menu="edu"><span class="i"><svg viewBox="0 0 24 24"><path d="M12 3a9 9 0 100 18 9 9 0 000-18zm1 13h-2v-2h2v2zm0-4h-2V6h2v6z"/></svg></span><span class="t">–°—ç—Ç–≥—ç–ª–∏–π–Ω –±–æ–ª–æ–≤—Å—Ä–æ–ª</span></div>
        <div class="acc" data-menu="health"><span class="i"><svg viewBox="0 0 24 24"><path d="M9 3h6v2H9zM7 7h10v2H7zm-2 4h14v2H5zm3 4h8v2H8z"/></svg></span><span class="t">–•–æ–æ–ª ¬∑ –î–∞—Å–≥–∞–ª</span></div>
        <div class="acc" data-menu="reminder"><span class="i"><svg viewBox="0 0 24 24"><path d="M12 8a4 4 0 110 8 4 4 0 010-8zm0-6v2m0 16v2m10-10h-2M4 12H2m15.5-6.5l-1.4 1.4M7.9 16.1l-1.4 1.4m0-12.4l1.4 1.4M16.1 16.1l1.4 1.4"/></svg></span><span class="t">–°–∞–Ω—É—É–ª–≥–∞</span></div>
        <div class="acc" data-menu="extra"><span class="i"><svg viewBox="0 0 24 24"><path d="M3 13h8V3H3v10zm10 8h8V11h-8v10z"/></svg></span><span class="t">–ù—ç–º—ç–ª—Ç —Ö”©—Ç”©–ª–±”©—Ä</span></div>

        <!-- –°—ç—Ç–≥—ç–ª–∏–π–Ω —Ö”©—Ç”©—á - Toggle —Ö–∏–π—Ö -->
        <div class="acc" data-menu="guides" id="guidesToggle">
          <span class="i"><svg viewBox="0 0 24 24"><path d="M4 4h16v10H5l-1 1V4zM8 18h8v2H8z"/></svg></span>
          <span class="t">–°—ç—Ç–≥—ç–ª–∏–π–Ω —Ö”©—Ç”©—á (—á–∞—Ç—É—É–¥) <span style="font:400 9px var(--font-ui);color:#999">‚†é‚†ë‚†û‚†õ‚†ë‚†á‚†ä‚†ä‚†ù ‚†ì‚†ï‚†û‚†ï‚†ó</span></span>
        </div>

        <!-- Guides Wrapper - Collapsible -->
        <div id="guidesWrap" class="collapse">
          <div class="guides-content">
            <div class="group-title">–≠–Ω–≥–∏–π–Ω –∞–Ω–≥–∏–ª–∞–ª</div>
            <div class="oy-pills" id="list-age"></div>

            <div class="group-title">–ë–∞–≥—Ü –∞–Ω–≥–∏–ª–∞–ª</div>
            <div class="oy-pills" id="list-bundle"></div>

            <div class="group-title">–¢—É—Å–≥–∞–π —Ö—ç—Ä—ç–≥—Ü—ç—ç—Ç –∞–Ω–≥–∏–ª–∞–ª <span style="font:400 8px var(--font-ui);color:#999;margin-left:6px">‚†û‚†•‚†é‚†õ‚†Å‚†ä ‚†ì‚†ë‚†ó‚†ë‚†õ‚†â‚†ë‚†ë‚†û</span></div>
            <div class="oy-pills" id="list-special"></div>
          </div>
        </div>

        <!-- –ò–¥—ç–≤—Ö—Ç—ç–π —á–∞—Ç—É—É–¥ - –≥–∞–¥–Ω–∞–∞ –≥–∞—Ä–≥–∞–≤ -->
        <div class="sec-title">–ò–¥—ç–≤—Ö—Ç—ç–π —á–∞—Ç—É—É–¥</div>
        <div id="activeList"></div>

        <!-- Menu Content Areas -->
        <div id="menuContent"></div>
      </div>
    </aside>

    <!-- Chat area -->
    <main class="oy-chat" id="oyChat">
      <div id="oyStream" class="oy-stream"></div>
    </main>

    <!-- Composer -->
    <div class="oy-composer">
      <div class="oy-row">
        <label for="oyFile" class="oy-file" title="–§–∞–π–ª/–∑—É—Ä–∞–≥"><span class="clip"></span></label>
        <input id="oyFile" type="file" multiple accept="image/*,.pdf" hidden>
        <textarea id="oyInput" class="oy-textarea" rows="1" placeholder="–≠–Ω–¥ –±–∏—á—ç—ç–¥ Enter –¥–∞—Ä–Ω–∞ —É—É‚Ä¶"></textarea>
        <button id="btnSend" class="oy-send" title="–ò–ª–≥—ç—ç—Ö"><span class="icon-send"></span></button>
      </div>
    </div>
  </div>

  <script>
  (function(){
    /* ---------- –≠–ª–µ–º–µ–Ω—Ç“Ø“Ø–¥ ---------- */
    const el = {
      open1: document.getElementById('oyOpen1'),
      open2: document.getElementById('oyOpen2'),
      overlay: document.getElementById('oyOverlay'),
      modal: document.getElementById('oyModal'),
      drawer: document.getElementById('oyDrawer'),
      btnDrawer: document.getElementById('btnDrawer'),
      btnClose: document.getElementById('btnClose'),
      title: document.getElementById('chatTitle'),
      stream: document.getElementById('oyStream'),
      input: document.getElementById('oyInput'),
      send: document.getElementById('btnSend'),
      file: document.getElementById('oyFile'),
      listAge: document.getElementById('list-age'),
      listBundle: document.getElementById('list-bundle'),
      listSpecial: document.getElementById('list-special'),
      activeList: document.getElementById('activeList'),
      accName: document.getElementById('accName'),
      accCode: document.getElementById('accCode'),
      guidesWrap: document.getElementById('guidesWrap'),
      guidesToggle: document.getElementById('guidesToggle'),
      menu: document.getElementById('menu'),
      menuContent: document.getElementById('menuContent'),
    };

    /* ---------- ”®–Ω–≥”©–Ω–¥ —Ç–æ—Ö–∏—Ä—É—É–ª–∂ —Ç–µ–∫—Å—Ç ”©–Ω–≥”© —Å–æ–Ω–≥–æ—Ö ---------- */
    const textColorFor = (hex)=>{
      const c = String(hex||'#eee').replace('#','');
      const r = parseInt(c.slice(0,2),16)||0, g = parseInt(c.slice(2,4),16)||0, b = parseInt(c.slice(4,6),16)||0;
      const L = (0.299*r + 0.587*g + 0.114*b)/255;
      return L > .7 ? '#111' : '#fff';
    };

    /* ---------- –ß–∞—Ç—É—É–¥—ã–Ω –∂–∞–≥—Å–∞–∞–ª—Ç ---------- */
    const AGE = [
      {slug:'age-0-7',  name:'–ë–∞–≥–∞ –±–∞–ª—á–∏—Ä “Ø–µ (0‚Äì7)',   color:'#E1D9C9'},
      {slug:'age-8-12', name:'–ê–¥—Ç–∞–π –±—è—Ü—Ö–∞–Ω “Ø–µ (8‚Äì12)', color:'#AE9372'},
      {slug:'age-13-18',name:'–°—ç—Ä–≥—ç–ª—ç–Ω ”©—Å–≤”©—Ä “Ø–µ (13‚Äì18)', color:'#B27D57'},
      {slug:'age-19-25',name:'–≠—Ö–ª—ç–ª, –º”©—Ä”©”©–¥–ª–∏–π–Ω “Ø–µ (19‚Äì25)', color:'#7F4B30'},
      {slug:'age-26-40',name:'–≠—Ä—Ö —á”©–ª”©”©—Ç, —ç—Ä—á —Ö“Ø—á—Ç—ç–π “Ø–µ (26‚Äì40)', color:'#A28B77'},
      {slug:'age-41-55',name:'–¢—É—Ä—à–ª–∞–≥–∞, –±“Ø—Ç—ç—ç–ª–∏–π–Ω “Ø–µ (41‚Äì55)', color:'#7D8769'},
      {slug:'age-56-70',name:'–£—Ö–∞–∞–Ω, –Ω”©–ª”©”©–ª–ª–∏–π–Ω “Ø–µ (56‚Äì70)', color:'#2A4C21'},
      {slug:'age-70p', name:'”®–≤–ª”©—Ö, “Ø–ª–¥—ç—ç—Ö “Ø–µ (70+)', color:'#173125'}
    ];
    const BUNDLES = [
      {slug:'fam',   name:'–ì—ç—Ä –±“Ø–ª',       color:'#D8A48F'},
      {slug:'career',name:'–ê–∂–∏–ª –º—ç—Ä–≥—ç–∂–ª–∏–π–Ω', color:'#957C60'},
      {slug:'class', name:'–ê–Ω–≥–∏ —Ö–∞–º—Ç –æ–ª–æ–Ω',  color:'#EFBE8C'},
      {slug:'sport', name:'–°–ø–æ—Ä—Ç, —É—Ä–ª–∞–≥–∏–π–Ω', color:'#ABAC97'},
      {slug:'org',   name:'–ë–∞–π–≥—É—É–ª–ª–∞–≥–∞',    color:'#A33A29'}
    ];
    const SPECIAL = [
      {slug:'vision',  name:'–•–∞—Ä–∞–∞–Ω—ã –±—ç—Ä—Ö—à—ç—ç–ª—Ç—ç–π', color:'#353326'},
      {slug:'special', name:'–¢—É—Å–≥–∞–π —Ö—ç—Ä—ç–≥—Ü—ç—ç—Ç',     color:'#897E45'}
    ];

    /* ---------- –ú—ç–Ω—é –∞–≥—É—É–ª–≥–∞ JSON-–æ–æ—Ä ---------- */
    const MENU_DATA = {
      profile: {
        title: "–ú–∏–Ω–∏–π –±“Ø—Ä—Ç–≥—ç–ª",
        content: `
          <div style="padding:20px">
            <h3>–•—É–≤–∏–π–Ω –º—ç–¥—ç—ç–ª—ç–ª</h3>
            <p>–ù—ç—Ä: <strong id="profileName">–•—ç—Ä—ç–≥–ª—ç–≥—á</strong></p>
            <p>–ö–æ–¥: <strong id="profileCode">OY-0000</strong></p>
            <p>–ë“Ø—Ä—Ç–≥“Ø“Ø–ª—Å—ç–Ω: 2024-08-20</p>
            <p>–°—Ç–∞—Ç—É—Å: –ò–¥—ç–≤—Ö—Ç—ç–π</p>
            <button style="padding:8px 16px;background:var(--brand);color:#fff;border:none;border-radius:8px;cursor:pointer">–ó–∞—Å–∞—Ö</button>
          </div>
        `
      }
    };

    /* ---------- –¢”©–ª”©–≤ ---------- */
    const LSKEY = 'oy_state_v3';
    let state = { account:{name:'–•—ç—Ä—ç–≥–ª—ç–≥—á', code:'OY-0000'}, current:null, active:{} };
    try{ const s = JSON.parse(localStorage.getItem(LSKEY)||'null'); if(s) state = s; }catch(e){}

    function save(){ localStorage.setItem(LSKEY, JSON.stringify(state)); }

    /* ---------- –ú—ç–Ω—é —Ö–∞—Ä—É—É–ª–∞—Ö/–Ω—É—É—Ö ---------- */
    function showMenu(menuKey) {
      // –ë“Ø—Ö –º—ç–Ω“Ø –Ω—É—É—Ö
      const allMenus = document.querySelectorAll('.menu-content');
      allMenus.forEach(m => m.classList.remove('active'));
      
      // –ß–∞—Ç—É—É–¥—ã–≥ –Ω—É—É—Ö
      el.guidesWrap.classList.remove('show');
      
      el.title.textContent = '–û—é—É–Ω—Å–∞–Ω–∞–∞ ‚Äî –ú—ç–Ω—é';
    }

    /* ---------- –ß–∞—Ç –º—ç–Ω“Ø toggle —Ö–∏–π—Ö —Ñ—É–Ω–∫—Ü ---------- */
    function toggleGuides() {
      const isOpen = el.guidesWrap.classList.contains('show');
      
      if(isOpen) {
        // –•–∞–∞—Ö “Ø–µ–¥: –∑”©–≤—Ö”©–Ω —á–∞—Ç —Å–æ–Ω–≥–æ—Ö —Ö—ç—Å–≥–∏–π–≥ –Ω—É—É—Ö, –∏–¥—ç–≤—Ö—Ç—ç–π —á–∞—Ç—É—É–¥ “Ø–ª–¥—ç–Ω—ç
        el.guidesWrap.classList.remove('show');
        el.title.textContent = '–û—é—É–Ω—Å–∞–Ω–∞–∞ ‚Äî –°—ç—Ç–≥—ç–ª–∏–π–Ω —Ö”©—Ç”©—á';
      } else {
        // –ù—ç—ç—Ö “Ø–µ–¥: –±—É—Å–∞–¥ –º—ç–Ω“Ø–≥ –Ω—É—É–≥–∞–∞–¥ —á–∞—Ç —Å–æ–Ω–≥–æ—Ö —Ö—ç—Å–≥–∏–π–≥ —Ö–∞—Ä—É—É–ª–∞—Ö
        const allMenus = document.querySelectorAll('.menu-content');
        allMenus.forEach(m => m.classList.remove('active'));
        
        el.guidesWrap.classList.add('show');
        el.title.textContent = '–û—é—É–Ω—Å–∞–Ω–∞–∞ ‚Äî –°—ç—Ç–≥—ç–ª–∏–π–Ω —Ö”©—Ç”©—á';
      }
    }

    /* ---------- –ú–µ–Ω“Ø–¥ —á–∞—Ç —Å–æ–Ω–≥–æ—Ö pills “Ø“Ø—Å–≥—ç—Ö ---------- */
    function renderPills(target, arr){
      target.innerHTML = '';
      arr.forEach(it=>{
        const pill = document.createElement('div');
        pill.className = 'oy-pill';
        pill.style.setProperty('--c', it.color);
        pill.style.setProperty('--tc', textColorFor(it.color));
        
        // –ó”©–≤—Ö”©–Ω "–•–∞—Ä–∞–∞–Ω—ã –±—ç—Ä—Ö—à—ç—ç–ª—Ç—ç–π" button-–¥ –±–∞—Ä–∏–∞–ª —Ü—ç–≥ –Ω—ç–º—ç—Ö
        if(it.slug === 'vision') {
          pill.innerHTML = `<span>${it.name} <span style="font:400 9px var(--font-ui);opacity:0.7">‚†ì‚†Å‚†ó‚†Å‚†Å‚†ù‚†Ω ‚†É‚†ë‚†ó‚†ì‚†±‚†ë‚†ë‚†á‚†û‚†ë‚†ä</span></span>`;
        } else {
          pill.innerHTML = `<span>${it.name}</span>`;
        }
        
        pill.onclick = ()=> selectChat(it);
        target.appendChild(pill);
      });
    }

    function renderGuidesFlat(){
      renderPills(el.listAge, AGE);
      renderPills(el.listBundle, BUNDLES);
      renderPills(el.listSpecial, SPECIAL);
      renderActive();
    }

    function renderActive(){
      if(!el.activeList) return; // Safety check
      el.activeList.innerHTML = '';
      
      const activeEntries = Object.entries(state.active);
      if(activeEntries.length === 0) {
        el.activeList.innerHTML = '<div style="color:#999;font:400 12px var(--font-ui);padding:10px;text-align:center">–ò–¥—ç–≤—Ö—Ç—ç–π —á–∞—Ç –±–∞–π—Ö–≥“Ø–π</div>';
        return;
      }
      
      activeEntries.forEach(([key, val])=>{
        const row = document.createElement('div');
        row.className = 'active-item';
        row.innerHTML = `<div style="display:flex;align-items:center;flex:1;min-width:0"><span class="dot" style="background:${val.color}"></span><span style="font:400 13px var(--font-ui);line-height:1.3;overflow:hidden;text-overflow:ellipsis">${val.name}</span></div>
                         <button class="rm" title="–•–∞—Å–∞—Ö">√ó</button>`;
        
        // –ß–∞—Ç —Å–æ–Ω–≥–æ—Ö event
        row.onclick = (e) => {
          if(e.target.classList.contains('rm')) return; // Remove button –¥–∞—Ä—Å–∞–Ω –±–æ–ª ignore
          state.current = key;
          save();
          el.title.textContent = '–û—é—É–Ω—Å–∞–Ω–∞–∞ ‚Äî ' + val.name;
          el.drawer.classList.remove('open');
          
          // –ú—ç–Ω—é –∫–æ–Ω—Ç–µ–Ω—Ç—ã–≥ –Ω—É—É—Ö
          const allMenus = document.querySelectorAll('.menu-content');
          allMenus.forEach(m => m.classList.remove('active'));
          
          // –∞–Ω—Ö–Ω—ã –º–µ—Å—Å–µ–∂
          el.stream.innerHTML = '';
          bubble('–°–∞–π–Ω —É—É, —Ö–∞–π—Ä—Ç –º–∏–Ω—å. –°–æ–Ω–≥–æ—Å–æ–Ω —á–∞—Ç–∞–∞—Ä–∞–∞ —è—Ä–∏–ª—Ü—å—è. üåø','bot');
        };
        
        row.querySelector('.rm').onclick = (e)=>{
          e.stopPropagation();
          delete state.active[key]; 
          if(state.current===key) state.current=null; 
          save(); 
          renderActive();
        };
        el.activeList.appendChild(row);
      });
    }

    /* ---------- –ß–∞—Ç –Ω—ç—ç—Ö / —Å–æ–Ω–≥–æ—Ö ---------- */
    function selectChat(it){
      const key = it.slug;
      state.active[key] = {name:it.name, color:it.color};
      state.current = key; save();
      el.title.textContent = '–û—é—É–Ω—Å–∞–Ω–∞–∞ ‚Äî ' + it.name;
      el.drawer.classList.remove('open');
      
      // –ú—ç–Ω—é –∫–æ–Ω—Ç–µ–Ω—Ç—ã–≥ –Ω—É—É—Ö
      const allMenus = document.querySelectorAll('.menu-content');
      allMenus.forEach(m => m.classList.remove('active'));
      
      // –∞–Ω—Ö–Ω—ã –º–µ—Å—Å–µ–∂
      el.stream.innerHTML = '';
      bubble('–°–∞–π–Ω —É—É, —Ö–∞–π—Ä—Ç –º–∏–Ω—å. –°–æ–Ω–≥–æ—Å–æ–Ω —á–∞—Ç–∞–∞—Ä–∞–∞ —è—Ä–∏–ª—Ü—å—è. üåø','bot');
      renderActive();
    }

    function bubble(text, who='bot'){
      const div = document.createElement('div');
      div.className = 'msg ' + (who==='user'?'user':'bot');
      div.innerHTML = text;
      el.stream.appendChild(div);
      el.stream.scrollTop = el.stream.scrollHeight;
    }

    /* ---------- –ò–ª–≥—ç—ç—Ö + –§–∞–π–ª ---------- */
    function send(){
      const t = (el.input.value||'').trim(); if(!t) return;
      if(!state.current){ bubble('–≠—Ö–ª—ç—ç–¥ –°—ç—Ç–≥—ç–ª–∏–π–Ω —Ö”©—Ç”©—á”©”©—Å —á–∞—Ç —Å–æ–Ω–≥–æ–æ—Ä–æ–π.','bot'); return; }
      bubble(escapeHtml(t), 'user');
      el.input.value = '';
      setTimeout(()=>{ const r = '–°–æ–Ω—Å–æ–∂ –±–∞–π–Ω–∞, –∞–º–∞—Ä –º–∏–Ω—å. –ê–º—å—Å–≥–∞–ª–∞–∞ –∑”©”©–ª–ª”©”©—Ä—ç–π‚Ä¶'; bubble(r,'bot'); }, 400);
    }
    
    if(el.send) el.send.addEventListener('click', send);
    if(el.input) el.input.addEventListener('keydown', e=>{ if(e.key==='Enter' && !e.shiftKey){ e.preventDefault(); send(); } });

    if(el.file) el.file.addEventListener('change', e=>{
      if(!state.current){ e.target.value=''; return; }
      const names = [...e.target.files].map(f=> f.name).slice(0,3).join(', ');
      if(names) bubble('–•–∞–≤—Å–∞—Ä–≥–∞—Å–∞–Ω: <i>'+ escapeHtml(names) +'</i>','user');
      e.target.value='';
    });

    /* ---------- Modal –Ω—ç—ç—Ö/—Ö–∞–∞—Ö ---------- */
    const openModal = ()=>{ 
      el.modal.hidden=false; 
      el.overlay.hidden=false; 
    };
    const closeModal= ()=>{ 
      el.modal.hidden=true;  
      el.overlay.hidden=true;  
      el.drawer.classList.remove('open'); // Drawer —á —Ö–∞–∞–Ω–∞
    };
    const toggleDrawer = ()=> el.drawer.classList.toggle('open');

    // Event listeners
    if(el.open1) el.open1.addEventListener('click', openModal);
    if(el.open2) el.open2.addEventListener('click', openModal);
    if(el.btnClose) el.btnClose.addEventListener('click', closeModal);
    if(el.btnDrawer) el.btnDrawer.addEventListener('click', toggleDrawer);
    if(el.overlay) el.overlay.addEventListener('click', closeModal);
    
    // Drawer –∞–≤—Ç–æ–º–∞—Ç–∞–∞—Ä —Ö–∞–∞—Ö
    document.addEventListener('click', (e)=>{
      if(!el.drawer.classList.contains('open')) return;
      if(e.target.closest('#oyDrawer')) return;
      if(e.target.closest('#btnDrawer')) return;
      el.drawer.classList.remove('open');
    });

    /* ---------- –ú—ç–Ω—é handler-—É—É–¥ ---------- */
    // –ú—ç–Ω—é –¥–∞—Ä–∞—Ö event
    document.addEventListener('click', (e) => {
      const menuItem = e.target.closest('.acc[data-menu]');
      if(!menuItem) return;
      
      const menuKey = menuItem.dataset.menu;
      
      if(menuKey === 'guides') {
        // –ß–∞—Ç –º—ç–Ω“Ø–≥ toggle —Ö–∏–π—Ö
        toggleGuides();
      } else {
        // –ë—É—Å–∞–¥ –º—ç–Ω“Ø–≥ —Ö–∞—Ä—É—É–ª–∞—Ö
        showMenu(menuKey);
      }
    });

    /* ---------- –≠—Ö–ª—ç—Ö ---------- */
    renderGuidesFlat();

    /* ---------- –ë“Ø—Ä—Ç–≥—ç–ª–∏–π–Ω –º—ç–¥—ç—ç–ª–ª–∏–π–≥ –≥–∞–¥–Ω–∞–∞—Å –æ–Ω–æ–æ—Ö ---------- */
    window.oySetAccount = function({name, code}={}){
      if(name) state.account.name = name;
      if(code) state.account.code = code;
      el.accName.textContent = state.account.name || '–•—ç—Ä—ç–≥–ª—ç–≥—á';
      el.accCode.textContent = state.account.code || 'OY-0000';
      save();
    };
    // —Ö–∞–¥–≥–∞–ª—Å–∞–Ω —É—Ç–≥—ã–≥ UI-–¥ —Ç—É—Å–≥–∞—Ö
    window.oySetAccount(state.account);

    /* ---------- Util ---------- */
    function escapeHtml(s){return s.replace(/[&<>"]/g, c=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[c]))}
  })();
  </script>
</body>
</html>,
     


